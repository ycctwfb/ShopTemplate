{% doc %}
  @prompt
    generate a dynamic animate header for my page with glowing love hearts and cupid shooting arrows
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-cupid-header-{{ ai_gen_id }} {
    display: block;
    position: relative;
    width: 100%;
    background: {{ block.settings.background_color }};
    overflow: hidden;
    padding: {{ block.settings.padding_top }}px 20px {{ block.settings.padding_bottom }}px;
  }

  .ai-cupid-header__canvas-{{ ai_gen_id }} {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1;
  }

  .ai-cupid-header__content-{{ ai_gen_id }} {
    position: relative;
    z-index: 2;
    text-align: center;
    max-width: 1200px;
    margin: 0 auto;
  }

  .ai-cupid-header__title-{{ ai_gen_id }} {
    font-size: {{ block.settings.title_size }}px;
    color: {{ block.settings.title_color }};
    margin: 0 0 16px;
    font-weight: 700;
  }

  .ai-cupid-header__subtitle-{{ ai_gen_id }} {
    font-size: {{ block.settings.subtitle_size }}px;
    color: {{ block.settings.subtitle_color }};
    margin: 0 0 24px;
  }

  .ai-cupid-header__cta-{{ ai_gen_id }} {
    display: inline-block;
    padding: 16px 40px;
    background-color: {{ block.settings.button_color }};
    color: {{ block.settings.button_text_color }};
    text-decoration: none;
    border-radius: {{ block.settings.button_radius }}px;
    font-size: {{ block.settings.button_size }}px;
    font-weight: 600;
    transition: all 0.3s ease;
  }

  .ai-cupid-header__cta-{{ ai_gen_id }}:hover {
    background-color: {{ block.settings.button_hover_color }};
    transform: translateY(-2px);
  }

  @media screen and (max-width: 749px) {
    .ai-cupid-header__title-{{ ai_gen_id }} {
      font-size: {{ block.settings.title_size | times: 0.7 }}px;
    }

    .ai-cupid-header__subtitle-{{ ai_gen_id }} {
      font-size: {{ block.settings.subtitle_size | times: 0.8 }}px;
    }
  }
{% endstyle %}

<cupid-header-{{ ai_gen_id }}
  class="ai-cupid-header-{{ ai_gen_id }}"
  data-heart-count="{{ block.settings.heart_count }}"
  data-heart-color="{{ block.settings.heart_color }}"
  data-heart-glow="{{ block.settings.heart_glow_color }}"
  data-arrow-speed="{{ block.settings.arrow_speed }}"
  data-cupid-enabled="{{ block.settings.show_cupid }}"
  {{ block.shopify_attributes }}
>
  <canvas class="ai-cupid-header__canvas-{{ ai_gen_id }}"></canvas>

  <div class="ai-cupid-header__content-{{ ai_gen_id }}">
    {% if block.settings.title != blank %}
      <h1 class="ai-cupid-header__title-{{ ai_gen_id }}">{{ block.settings.title }}</h1>
    {% endif %}

    {% if block.settings.subtitle != blank %}
      <p class="ai-cupid-header__subtitle-{{ ai_gen_id }}">{{ block.settings.subtitle }}</p>
    {% endif %}

    {% if block.settings.button_text != blank %}
      <a href="{{ block.settings.button_link }}" class="ai-cupid-header__cta-{{ ai_gen_id }}">
        {{ block.settings.button_text }}
      </a>
    {% endif %}
  </div>
</cupid-header-{{ ai_gen_id }}>

<script>
  (function() {
    class CupidHeader{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
        this.canvas = this.querySelector('.ai-cupid-header__canvas-{{ ai_gen_id }}');
        this.ctx = this.canvas.getContext('2d');
        this.hearts = [];
        this.arrows = [];
        this.cupid = null;
        this.animationId = null;
      }

      connectedCallback() {
        this.heartCount = parseInt(this.dataset.heartCount) || 15;
        this.heartColor = this.dataset.heartColor || '#ff1493';
        this.heartGlow = this.dataset.heartGlow || '#ff69b4';
        this.arrowSpeed = parseFloat(this.dataset.arrowSpeed) || 3;
        this.cupidEnabled = this.dataset.cupidEnabled === 'true';

        this.resizeCanvas();
        this.initHearts();
        if (this.cupidEnabled) {
          this.initCupid();
        }
        this.animate();

        window.addEventListener('resize', this.resizeCanvas.bind(this));
      }

      disconnectedCallback() {
        if (this.animationId) {
          cancelAnimationFrame(this.animationId);
        }
        window.removeEventListener('resize', this.resizeCanvas.bind(this));
      }

      resizeCanvas() {
        this.canvas.width = this.offsetWidth;
        this.canvas.height = this.offsetHeight;
      }

      initHearts() {
        this.hearts = [];
        for (let i = 0; i < this.heartCount; i++) {
          this.hearts.push({
            x: Math.random() * this.canvas.width,
            y: Math.random() * this.canvas.height,
            size: Math.random() * 15 + 10,
            speedX: (Math.random() - 0.5) * 0.5,
            speedY: (Math.random() - 0.5) * 0.5,
            pulse: Math.random() * Math.PI * 2,
            pulseSpeed: Math.random() * 0.05 + 0.02
          });
        }
      }

      initCupid() {
        this.cupid = {
          x: -100,
          y: this.canvas.height * 0.3,
          size: 40,
          speedX: 1.5,
          direction: 1,
          shootTimer: 0,
          shootInterval: 120
        };
      }

      drawHeart(x, y, size, glow) {
        this.ctx.save();
        this.ctx.translate(x, y);
        this.ctx.scale(size / 20, size / 20);

        if (glow > 0) {
          this.ctx.shadowBlur = 20 + glow * 10;
          this.ctx.shadowColor = this.heartGlow;
        }

        this.ctx.fillStyle = this.heartColor;
        this.ctx.beginPath();
        this.ctx.moveTo(0, 0);
        this.ctx.bezierCurveTo(-10, -10, -20, -5, -20, 5);
        this.ctx.bezierCurveTo(-20, 15, -10, 20, 0, 25);
        this.ctx.bezierCurveTo(10, 20, 20, 15, 20, 5);
        this.ctx.bezierCurveTo(20, -5, 10, -10, 0, 0);
        this.ctx.fill();

        this.ctx.restore();
      }

      drawCupid(x, y, size) {
        this.ctx.save();
        this.ctx.translate(x, y);

        this.ctx.fillStyle = '#ffd700';
        this.ctx.beginPath();
        this.ctx.arc(0, 0, size * 0.4, 0, Math.PI * 2);
        this.ctx.fill();

        this.ctx.fillStyle = '#ffe4b5';
        this.ctx.beginPath();
        this.ctx.arc(-size * 0.15, -size * 0.1, size * 0.15, 0, Math.PI * 2);
        this.ctx.arc(size * 0.15, -size * 0.1, size * 0.15, 0, Math.PI * 2);
        this.ctx.fill();

        this.ctx.strokeStyle = '#8b4513';
        this.ctx.lineWidth = 3;
        this.ctx.beginPath();
        this.ctx.arc(size * 0.5, 0, size * 0.6, Math.PI * 0.7, Math.PI * 1.3);
        this.ctx.stroke();

        this.ctx.restore();
      }

      drawArrow(x, y, angle, length) {
        this.ctx.save();
        this.ctx.translate(x, y);
        this.ctx.rotate(angle);

        this.ctx.strokeStyle = '#8b4513';
        this.ctx.lineWidth = 2;
        this.ctx.beginPath();
        this.ctx.moveTo(0, 0);
        this.ctx.lineTo(length, 0);
        this.ctx.stroke();

        this.ctx.fillStyle = '#ff1493';
        this.ctx.beginPath();
        this.ctx.moveTo(length, 0);
        this.ctx.lineTo(length - 8, -5);
        this.ctx.lineTo(length - 8, 5);
        this.ctx.closePath();
        this.ctx.fill();

        this.ctx.restore();
      }

      updateHearts() {
        this.hearts.forEach(heart => {
          heart.x += heart.speedX;
          heart.y += heart.speedY;
          heart.pulse += heart.pulseSpeed;

          if (heart.x < -20) heart.x = this.canvas.width + 20;
          if (heart.x > this.canvas.width + 20) heart.x = -20;
          if (heart.y < -20) heart.y = this.canvas.height + 20;
          if (heart.y > this.canvas.height + 20) heart.y = -20;

          const glowIntensity = Math.sin(heart.pulse) * 0.5 + 0.5;
          this.drawHeart(heart.x, heart.y, heart.size, glowIntensity);
        });
      }

      updateCupid() {
        if (!this.cupidEnabled || !this.cupid) return;

        this.cupid.x += this.cupid.speedX * this.cupid.direction;

        if (this.cupid.x > this.canvas.width + 100) {
          this.cupid.direction = -1;
          this.cupid.y = Math.random() * this.canvas.height * 0.6 + this.canvas.height * 0.2;
        }
        if (this.cupid.x < -100) {
          this.cupid.direction = 1;
          this.cupid.y = Math.random() * this.canvas.height * 0.6 + this.canvas.height * 0.2;
        }

        this.drawCupid(this.cupid.x, this.cupid.y, this.cupid.size);

        this.cupid.shootTimer++;
        if (this.cupid.shootTimer >= this.cupid.shootInterval) {
          this.shootArrow();
          this.cupid.shootTimer = 0;
        }
      }

      shootArrow() {
        const angle = (Math.random() - 0.5) * 0.5;
        this.arrows.push({
          x: this.cupid.x,
          y: this.cupid.y,
          angle: angle,
          speed: this.arrowSpeed,
          length: 30,
          direction: this.cupid.direction
        });
      }

      updateArrows() {
        this.arrows = this.arrows.filter(arrow => {
          arrow.x += Math.cos(arrow.angle) * arrow.speed * arrow.direction;
          arrow.y += Math.sin(arrow.angle) * arrow.speed;

          const onScreen = arrow.x > -50 && arrow.x < this.canvas.width + 50 &&
                          arrow.y > -50 && arrow.y < this.canvas.height + 50;

          if (onScreen) {
            this.drawArrow(arrow.x, arrow.y, arrow.angle, arrow.length);
          }

          return onScreen;
        });
      }

      animate() {
        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

        this.updateHearts();
        this.updateCupid();
        this.updateArrows();

        this.animationId = requestAnimationFrame(this.animate.bind(this));
      }
    }

    customElements.define('cupid-header-{{ ai_gen_id }}', CupidHeader{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Cupid header",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "inline_richtext",
      "id": "title",
      "label": "Title",
      "default": "Love is in the Air"
    },
    {
      "type": "inline_richtext",
      "id": "subtitle",
      "label": "Subtitle",
      "default": "Discover our Valentine's collection"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button text",
      "default": "Shop Now"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Button link"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 50,
      "max": 200,
      "step": 10,
      "unit": "px",
      "label": "Top padding",
      "default": 100
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 50,
      "max": 200,
      "step": 10,
      "unit": "px",
      "label": "Bottom padding",
      "default": 100
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background",
      "default": "#1a1a1a"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Title",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "subtitle_color",
      "label": "Subtitle",
      "default": "#cccccc"
    },
    {
      "type": "color",
      "id": "button_color",
      "label": "Button background",
      "default": "#ff1493"
    },
    {
      "type": "color",
      "id": "button_hover_color",
      "label": "Button hover background",
      "default": "#ff69b4"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button text",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "range",
      "id": "title_size",
      "min": 24,
      "max": 80,
      "step": 2,
      "unit": "px",
      "label": "Title size",
      "default": 48
    },
    {
      "type": "range",
      "id": "subtitle_size",
      "min": 14,
      "max": 32,
      "step": 2,
      "unit": "px",
      "label": "Subtitle size",
      "default": 18
    },
    {
      "type": "range",
      "id": "button_size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Button text size",
      "default": 16
    },
    {
      "type": "range",
      "id": "button_radius",
      "min": 0,
      "max": 50,
      "step": 2,
      "unit": "px",
      "label": "Button border radius",
      "default": 8
    },
    {
      "type": "header",
      "content": "Hearts"
    },
    {
      "type": "range",
      "id": "heart_count",
      "min": 5,
      "max": 30,
      "step": 1,
      "label": "Heart count",
      "default": 15
    },
    {
      "type": "color",
      "id": "heart_color",
      "label": "Heart color",
      "default": "#ff1493"
    },
    {
      "type": "color",
      "id": "heart_glow_color",
      "label": "Heart glow color",
      "default": "#ff69b4"
    },
    {
      "type": "header",
      "content": "Cupid"
    },
    {
      "type": "checkbox",
      "id": "show_cupid",
      "label": "Show cupid",
      "default": true
    },
    {
      "type": "range",
      "id": "arrow_speed",
      "min": 1,
      "max": 6,
      "step": 0.5,
      "unit": "px",
      "label": "Arrow speed",
      "default": 3
    }
  ],
  "presets": [
    {
      "name": "Cupid header"
    }
  ]
}
{% endschema %}
